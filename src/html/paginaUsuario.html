<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perfil do Usuário</title>
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/logo-notific.svg') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/perfil.css') }}" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
  </head>

  <body data-app-user='{{ usuario | default(None) | tojson | safe }}'>
    <script>
      // Lê o JSON injetado no atributo data-app-user do body
      (function () {
        try {
          const raw = document.body.getAttribute('data-app-user');
          window.APP_USER = raw ? JSON.parse(raw) : null;
        } catch (e) {
          // Em caso de parse inválido, garante que não quebre o JS do cliente
          console.error('Erro ao parsear data-app-user:', e);
          window.APP_USER = null;
        }
      })();
    </script>
    <!-- Header principal -->
    <header class="main-header">
      <a href="{{ url_for('home_routes.home') }}">
        <img src="{{ url_for('static', filename='img/notific.svg') }}" alt="Ícone do notifIC" class="logo-IC" />
      </a>

      <div id="profileButton" aria-label="Abrir menu lateral">
        <img src="https://i.pravatar.cc/150" alt="Foto do perfil" />
      </div>
    </header>

    <!-- Side menu (same format as home.html) -->
    <aside class="side-menu" id="sideMenu">
      <header>
        <button class="close-btn" onclick="toggleMenu()">→</button>
        <span class="menu-title">./notif<span style="color: deepskyblue">IC</span></span>
      </header>
      <nav>
        <a href="{{ url_for('home_routes.home') }}">Página Inicial</a>
        <a href="{{ url_for('user_routes.perfil') }}" class="active">Perfil</a>
        <a href="{{ url_for('news_routes.news_page') }}">Cadastrar Notícia</a>
        <a href="#" class="logout-link">Sair</a>
      </nav>
      <footer>© 2025 ./notifIC</footer>
    </aside>

    <div class="side-menu-backdrop" id="sideMenuBackdrop" onclick="toggleMenu()"></div>

    <!-- Conteúdo principal -->
    <main class="profile-container">
      <div class="profile-content">
        <!-- Informações do usuário -->
        <section class="section-container profile-info-section">
          <h2>Informações</h2>
          <div class="profile-details">
            <div class="profile-avatar">
              <img
                id="profile-picture"
                src="https://i.pravatar.cc/150"
                alt="Foto de Perfil"
              />
              <div class="avatar-actions">
                <button id="change-photo-btn" type="button">
                  <i class="fas fa-camera"></i> Mudar foto de perfil
                </button>
                <input
                  type="file"
                  id="photo-upload"
                  accept="image/*"
                  style="display: none"
                />
                <button id="choose-photo-btn" type="button">
                  <i class="fas fa-upload"></i> Escolher foto
                </button>
              </div>
            </div>

            <form class="user-info-fields">
              <div class="info-group">
                <label for="username">Nome de usuário</label>
                <input
                  type="text"
                  id="username"
                  name="username"
                  placeholder="Nome"
                  disabled
                />
              </div>
              <div class="info-group">
                <label for="email">Email cadastrado</label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  placeholder="Email"
                  disabled
                />
              </div>
              <div class="info-group">
                <label for="role">Cargo</label>
                <input type="text" id="role" name="role" disabled />
              </div>
            </form>
          </div>
        </section>

        <!-- Preferências de notificações -->
        <section class="section-container notification-section">
          <h2>Preferências de Notificações</h2>
          <div class="preferences-list">
            <div class="preference-item">
              <span>EVENTO</span>
              <label class="switch">
                <input type="checkbox" checked />
                <span class="slider round"></span>
              </label>
            </div>
            <div class="preference-item">
              <span>PROJETO</span>
              <label class="switch">
                <input type="checkbox" checked />
                <span class="slider round"></span>
              </label>
            </div>
            <div class="preference-item">
              <span>VAGA</span>
              <label class="switch">
                <input type="checkbox" checked />
                <span class="slider round"></span>
              </label>
            </div>
          </div>
        </section>
      </div>
    </main>

    <script src="{{ url_for('static', filename='javascript/perfil.js') }}"></script>
    <script src="{{ url_for('static', filename='javascript/perfil_page.js') }}"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const logoutEls = document.querySelectorAll('.logout-link');
        logoutEls.forEach(function (el) {
          el.addEventListener('click', async function (e) {
              e.preventDefault();
              try {
                await fetch("{{ url_for('auth_routes.logout') }}", {
                  method: 'POST',
                  credentials: 'same-origin',
                  headers: { 'Content-Type': 'application/json' },
                });
              } catch (err) {
                // ignore network errors
              }
              // Redirect to home page after logout
              window.location = "{{ url_for('home_routes.home') }}";
            });
        });
      });
    </script>
  </body>
</html>