<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anuncie seu Evento</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/feed.css') }}">
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/logo-notific.svg') }}" />
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar">
    <a href="/">
      <img src="{{ url_for('static', filename='img/notific.svg') }}" alt="logo do notific" class="logo-ic">
    </a>
  </nav>

  <!-- Formulário -->
  <div class="container">
    <h2>Anuncie seu evento</h2>
    <p>Preencha os dados abaixo para publicar no Notific.</p>

    <!-- Image upload removed: images are provided via static news JSON only -->
    <!-- Image upload (Cloudinary) -->
    <label for="file">Imagem (opcional)</label>
    <input type="file" id="file" name="file" accept="image/*">
    <input type="hidden" id="upload_news_id" name="news_id" value="">
    <button id="uploadImageBtn" type="button">Enviar Imagem</button>
    <div id="uploadResult" style="margin-top:8px;color:green;"></div>

    <script>
    document.getElementById('uploadImageBtn').addEventListener('click', async function(){
      const f = document.getElementById('file').files[0];
      if(!f) return alert('Escolha um arquivo');
      const form = new FormData();
      form.append('file', f);
      const newsId = document.getElementById('upload_news_id').value;
      if(newsId) form.append('news_id', newsId);

      // Try to get token from localStorage or cookies
      const token = localStorage.getItem('access_token') || '';
      try{
        const resp = await fetch('/upload-image', { method: 'POST', headers: token ? { 'Authorization': 'Bearer ' + token } : {}, body: form });
        const data = await resp.json();
        if(resp.ok){
          document.getElementById('uploadResult').textContent = 'Upload OK';
        } else {
          document.getElementById('uploadResult').textContent = 'Erro: ' + (data.error || JSON.stringify(data));
          document.getElementById('uploadResult').style.color = 'red';
        }
      }catch(e){
        document.getElementById('uploadResult').textContent = 'Erro de rede';
        document.getElementById('uploadResult').style.color = 'red';
      }
    });
    </script>

    <!-- Institution field removed: not part of News model -->

    <label for="titulo">Título</label>
    <input type="text" id="titulo" placeholder="Título do evento">

    <label for="email">Email</label>
    <input type="email" id="email" placeholder="voce@email.com">

    <label for="descricao">Descrição do evento (Markdown permitido)</label>
    <textarea id="descricao" placeholder="Escreva a descrição do evento..."></textarea>

    <h3>Pré-visualização:</h3>
    <div id="preview" class="preview"></div>

    <div class="form-row">
      <div>
        <label for="data-inicio">Data de início</label>
        <input type="date" id="data-inicio">
      </div>
      <div>
        <label for="data-fim">Data de término</label>
        <input type="date" id="data-fim">
      </div>
    </div>
    <div class="form-row">
      <div>
        <!-- Local removed: use description/content to include location if needed -->
      </div>
      <div>
        <label for="site">Link para o site oficial</label>
        <input type="url" id="site" placeholder="https://...">
      </div>
    </div>


    <button type="submit">Enviar Anúncio</button>
  </div>

  <!-- Biblioteca para Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Biblioteca para Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Script externo -->
  <script src="{{ url_for('static', filename='javascript/preview.js') }}"></script>
  <!-- Script para submissão de notícias -->
  <script src="{{ url_for('static', filename='javascript/submit_news.js') }}" defer></script>

</body>

</html>