<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>notifIC</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}" />
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/logo-notific.svg') }}" />
  </head>
  <body>
    <header>
      <div class="header-logo">
        <a href="{{ url_for('home_routes.home') }}">
          <img src="{{ url_for('static', filename='img/notific.svg') }}" alt="Logo NotifIC" id="logo-img" />
        </a>
      </div>
      <div class="header-search-wrapper">
        <svg
          class="search-icon"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z"
            clip-rule="evenodd"
          />
        </svg>
        <input type="text" id="searchBar" placeholder="Buscar not√≠cias..." />
      </div>

      <!-- Bot√£o de Notifica√ß√µes -->
      <div class="header-notifications-wrapper">
        <button
          id="notificationsButton"
          class="header-icon-btn"
          title="Notifica√ß√µes"
        >
          <span class="notifications-icon">üîî</span>
          <span id="notificationBadge" class="notification-badge">0</span>
        </button>
        <div id="notificationsDropdown" class="notifications-dropdown">
          <div class="notifications-header">
            <h3>Notifica√ß√µes</h3>
            <div class="notification-actions">
              <button id="markAllRead">Marcar como lidas</button>
              <button id="clearAllNotifications">Limpar todas</button>
            </div>
          </div>
          <div id="notificationsList" class="notifications-list">
            <!-- Notifica√ß√µes ser√£o inseridas aqui via JavaScript -->
          </div>
          <div class="notifications-footer">
            <a href="#" class="view-all-link">Ver todas</a>
          </div>
        </div>
      </div>

      <!-- Agrupa nome do usu√°rio e √≠cone de perfil para posicionamento correto -->
      <div class="header-user-area">
        <div id="headerUsername" aria-live="polite"></div>
        <div id="profileButton">
          <span class="profile-icon">üë§</span>
          <img src="https://i.pravatar.cc/40" alt="Perfil" />
        </div>
      </div>
    </header>
    <section class="hero-carousel">
      <div class="carousel-container">
        <div class="carousel-slides-wrapper"></div>
        <button id="carousel-prev" class="carousel-nav-btn">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M12.79 5.23a.75.75 0 010 1.06L9.06 10l3.73 3.71a.75.75 0 11-1.06 1.06l-4.25-4.25a.75.75 0 010-1.06l4.25-4.25a.75.75 0 011.06 0z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
        <button id="carousel-next" class="carousel-nav-btn">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M7.21 14.77a.75.75 0 010-1.06L10.94 10 7.21 6.29a.75.75 0 111.06-1.06l4.25 4.25a.75.75 0 010 1.06l-4.25 4.25a.75.75 0 01-1.06 0z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
        <div class="carousel-dots"></div>
      </div>
    </section>

    <aside class="side-menu" id="sideMenu">
      <header>
        <button class="close-btn" onclick="toggleMenu()">‚Üí</button>
        <span class="menu-title"
          >./notif<span style="color: deepskyblue">IC</span></span
        >
      </header>
      <nav>
        <a href="{{ url_for('user_routes.perfil') }}">Perfil</a>
        <a href="{{ url_for('news_routes.news_page') }}">Cadastrar Not√≠cia</a>
        <a href="#" class="logout-link">Sair</a>
      </nav>
      <footer>¬© 2025 ./notifIC</footer>
    </aside>

    <div
      class="side-menu-backdrop"
      id="sideMenuBackdrop"
      onclick="toggleMenu()"
    ></div>

    <div class="tabs">
      <div class="tab" data-tab="pessoal">Pessoal</div>
      <div class="tab active" data-tab="geral">Geral</div>
      <div class="tab" data-tab="vagas">Vagas</div>
    </div>

    <div class="feed-header">
      <h2>Feed</h2>
      <div class="feed-actions">
        <button id="filterBtn" title="Filtrar">
          <span class="filter-icon">‚â°</span>
        </button>
        <button id="adminBtn" title="Admin" style="display: none">‚öôÔ∏è</button>
      </div>
    </div>
    <p class="feed-subtitle">Not√≠cias e oportunidades</p>

    <div id="filterMenu" class="filter-menu"></div>
    <div id="adminMenu" class="filter-menu"></div>

    <section class="feed" id="feed"></section>

    <footer>
      <div>
        <h4>Contato</h4>
        <p>
          Instituto de Computa√ß√£o - UFAL<br />
          NotificUFAL@gmail.com
        </p>
      </div>
      <div>
        <h4>Links R√°pidos</h4>
          <p>
          <a href="{{ url_for('news_routes.news_page') }}">Anuncie no site</a><br />
          <a href="mailto:NotificUFAL@gmail.com">Contate-nos</a>
        </p>
      </div>
      <div>
        <h4>./notific</h4>
        <p>
          Plataforma de divulga√ß√£o de oportunidades e not√≠cias para o Instituto
          de Computa√ß√£o da UFAL.
        </p>
      </div>
    </footer>

  <script src="{{ url_for('static', filename='javascript/notification.js') }}"></script>
  <script src="{{ url_for('static', filename='javascript/home.js') }}" defer></script>
  <script>
    // Inicializa o sistema de notifica√ß√µes
    if (typeof initNotificationSystem === 'function') {
      initNotificationSystem();
    }

    // Logout via POST to clear HttpOnly cookie, then redirect to login page
    document.addEventListener('DOMContentLoaded', function () {
      const logoutEls = document.querySelectorAll('.logout-link');
      logoutEls.forEach(function (el) {
          el.addEventListener('click', async function (e) {
          e.preventDefault();
          try {
            await fetch("{{ url_for('auth_routes.logout') }}", {
              method: 'POST',
              credentials: 'same-origin',
              headers: { 'Content-Type': 'application/json' },
            });
          } catch (err) {
            // ignore network errors, still redirect
          }
          // Redirect to home page after logout (instead of login page)
          window.location = "{{ url_for('home_routes.home') }}";
        });
      });
    });
  </script>
  </body>
</html>
