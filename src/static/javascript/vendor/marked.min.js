// Minimal fallback implementation for marked.parse to avoid external CDN.
// This is NOT the full Marked library; it handles basic markdown tokens.
// If you need full features, install marked via npm and bundle locally.
(function(global){
  if(global.marked && typeof global.marked.parse === 'function') { return; }
  function escapeHtml(str){
    return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }
  function parse(md){
    if(!md) return '';
    md = escapeHtml(md);
    // headings
    md = md.replace(/^### (.+)$/gm,'<h3>$1</h3>')
           .replace(/^## (.+)$/gm,'<h2>$1</h2>')
           .replace(/^# (.+)$/gm,'<h1>$1</h1>');
    // bold & italic
    md = md.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
           .replace(/\*(.+?)\*/g,'<em>$1</em>');
    // inline code
    md = md.replace(/`([^`]+?)`/g,'<code>$1</code>');
    // links [text](url)
    md = md.replace(/\[(.+?)\]\((https?:\/\/[^\s)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');
    // paragraphs
    const blocks = md.split(/\n{2,}/).map(function(b){return '<p>'+b.replace(/\n/g,'<br>')+'</p>';});
    return blocks.join('\n');
  }
  global.marked = { parse: parse };
})(window);
